{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/viewbooks.css' %}">
<link rel="stylesheet" href="{% static 'css/viewdetail.css' %}">
{% endblock %}

{% block content %}

<div class="view-detail-container">
    <img src="{{ view.image.url }}" alt="{{ view.name }}">

    <div class="view-detail-info">
        <h3 class="book-title">{{ view.name }}</h3>
        <p><span class="detail-label">AUTHOR:</span> 
        <span class="detail-value">{{ view.author }}</span></p>

        <p><span class="detail-label">CATEGORY:</span> 
        <span class="detail-value">{{ view.category }}</span></p>

        <p><span class="detail-label">BOOK NO:</span> 
        <span class="detail-value">{{ view.book_no }}</span></p>

        <p><span class="detail-label">LANGUAGE:</span> 
        <span class="detail-value">{{ view.language }}</span></p>


        
        {% if view.available_copies > 0 %}
            <p class="text-success">
                <i class="bi bi-check-circle-fill"></i> Available
            </p>
        {% else %}
            <p class="text-danger">
                <i class="bi bi-x-circle-fill"></i> Not Available
            </p>
            <form method="post" action="{% url 'reserve_book' view.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning">
                    <i class="bi bi-bookmark-plus-fill"></i> Reserve
                </button>
            </form>
        {% endif %}

        
        {% if request.user.is_superuser %}
        <div class="mt-3">
            {% if view.available_copies > 0 %}
                <p><b>Available Copies:</b> {{ view.available_copies }}</p>
                <a href="{% url 'borrow_book' view.id %}" class="neon-btn warn">
                    <span></span><span></span><span></span><span></span>
                    <i class="bi bi-journal-arrow-down"></i> BORROW BOOK
                </a>
            {% else %}
                <p class="text-danger"><b>No copies available</b></p>
                <button class="btn btn-secondary" disabled>
                    <i class="bi bi-journal-x"></i> Borrow Book
                </button>
            {% endif %}
        </div>
        {% endif %}

        {% if is_librarian %}
            <p><b>Created:</b> {{ view.created_at|date:"d M Y, h:i A" }}</p>
            <p><b>Updated:</b> {{ view.updated_at|date:"d M Y, h:i A" }}</p>
        {% endif %}

        {% if is_librarian %}
            <a href="{% url 'editbook' view.id %}" class="neon-btn warn">
                <span></span><span></span><span></span><span></span>
                <i class="bi bi-pencil-square"></i> EDIT
            </a>
            <a href="{% url 'deletebook' view.id %}" class="neon-btn danger">
                <span></span><span></span><span></span><span></span>
                <i class="bi bi-trash"></i> DELETE
            </a>
        {% endif %}
    </div>
</div>


<div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="notificationLabel">
          <i class="bi bi-bell-fill"></i> Notification
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mb-0">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle"></i> Close
        </button>
      </div>
    </div>
  </div>
</div>

{% if messages %}
<script>
  var notificationModal = new bootstrap.Modal(document.getElementById('notificationModal'));
  notificationModal.show();
</script>
{% endif %}

{% endblock %}
